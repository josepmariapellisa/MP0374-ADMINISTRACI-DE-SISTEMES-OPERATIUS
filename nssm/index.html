
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../systemd/">
      
      
        <link rel="next" href="../LICENSE/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.0">
    
    
      
        <title>Pràctica 2 - MP0374-ADMINISTRACIÓ DE SISTEMES OPERATIUS</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.9f615399.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#practica-gestio-de-serveis-windows-amb-nssm-i-scripts" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="MP0374-ADMINISTRACIÓ DE SISTEMES OPERATIUS" class="md-header__button md-logo" aria-label="MP0374-ADMINISTRACIÓ DE SISTEMES OPERATIUS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MP0374-ADMINISTRACIÓ DE SISTEMES OPERATIUS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Pràctica 2
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="MP0374-ADMINISTRACIÓ DE SISTEMES OPERATIUS" class="md-nav__button md-logo" aria-label="MP0374-ADMINISTRACIÓ DE SISTEMES OPERATIUS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    MP0374-ADMINISTRACIÓ DE SISTEMES OPERATIUS
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inici
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../systemd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pràtica 1
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Pràctica 2
  </span>
  

      </a>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../LICENSE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Llicència
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="practica-gestio-de-serveis-windows-amb-nssm-i-scripts">Pràctica: Gestió de Serveis Windows amb NSSM i Scripts</h1>
<p>Aquesta pràctica ens introduirà en la gestió avançada de serveis Windows mitjançant <strong>NSSM</strong> (Non-Sucking Service Manager) i l'automatització amb scripts, on aprendrem a instal·lar i configurar NSSM per crear i gestionar serveis Windows, convertir aplicacions en serveis, personalitzar paràmetres de servei, i desenvolupar scripts Batch i PowerShell per automatitzar tasques i controlar el cicle de vida dels serveis (inici, aturada, reinici), amb l'objectiu final de capacitar-nos per executar aplicacions de manera fiable en entorns Windows de producció i solucionar problemes comuns en la gestió de serveis.</p>
<p><img alt="Captura" src="../custom/Selecci%C3%B3_054.png" /></p>
<p>S'instal·la el servei "Servei_Pellisa" mitjançant l'eina NSSM des de la línia de comandes. La comanda associa el servei amb l'script batch ubicat a "C:\script_pellisa\script.bat". El sistema respon confirmant que el servei s'ha instal·lat correctament.</p>
<p><img alt="Captura" src="../custom/Selecci%C3%B3_055.png" /></p>
<p>S'executa la comanda <code>nssm set</code> per configurar les credencials del servei "Servei_Pellisa". S'estableix l'usuari "DESKTOP-34U@860\pellisa" amb contrasenya per al compte de servei. El sistema confirma que el paràmetre "ObjectName" s'ha configurat correctament per al servei.</p>
<p><img alt="Captura" src="../custom/Selecci%C3%B3_056.png" /></p>
<p>S'utilitza la comanda <code>nssm set</code> per configurar l'inici automàtic del servei "Servei_Pellisa". S'estableix el paràmetre de inici en "SERVICE_AUTO_START" per garantir que el servei s'iniciï automàticament amb el sistema. El sistema confirma que el paràmetre "Start" s'ha aplicat correctament al servei.</p>
<p><img alt="Captura" src="../custom/Selecci%C3%B3_057.png" /></p>
<p>S'intenta iniciar el servei "Servei_Pellisa" mitjançant la comanda <code>nssm start</code>. El sistema respon que ja existeix una instància del servei en execució. Aquest missatge indica que el servei està actiu i funcionant correctament.</p>
<p><img alt="Captura" src="../custom/Selecci%C3%B3_063.png" /></p>
<p>S'actualitza la ruta de l'aplicació del servei "Servei_Pellisa" cap a "C:\script_pellisa\script.bat". Addicionalment, s'estableix el directori de treball del servei a "C:\script_pellisa". Ambdues configuracions es confirmen correctament per part del sistema NSSM.</p>
<p><img alt="Captura" src="../custom/Selecci%C3%B3_064.png" /></p>
<p>S'executa la comanda <code>nssm restart</code> per reiniciar el servei "Servei_Pellisa". El sistema atura correctament la instància existent del servei i posteriorment inicia una nova instància. Ambdues operacions es completen amb èxit, confirmant el reinici del servei.</p>
<p><img alt="Captura" src="../custom/Selecci%C3%B3_065.png" /></p>
<p>S'observa el servei "Servei_Pellisa" en execució al sistema amb ID de procés 2916. El servei apareix actiu i funcionant correctament al gestor de tasques de Windows.</p>
<p><img alt="Captura" src="../custom/Selecci%C3%B3_066.png" /></p>
<p>S'identifica el servei "Servei_Pellisa" configurat correctament a la llista de serveis de Windows. El servei està configurat amb tipus d'inici "Automàtic" i s'executa sota el compte d'usuari "pellisa". El servei apareix registrat i operatiu dins dels serveis del sistema local.</p>
<p><img alt="Captura" src="../custom/Selecci%C3%B3_067.png" /></p>
<p>S'utilitza la comanda <code>nssm set</code> per configurar el comportament de sortida de l'aplicació del servei "Servei_Pellisa". S'estableix el paràmetre "AppExit" amb el valor "Exit", definint com el servei ha de gestionar la finalització de l'aplicació. El sistema confirma que el paràmetre s'ha aplicat correctament al servei.</p>
<p><img alt="Captura" src="../custom/Selecci%C3%B3_076.png" /></p>
<p>S'obre el script batch "script.bat" que conté la lògica del servei. El script genera logs del sistema en la carpeta "C:\script_pellisa\service_logs" i executa un script PowerShell per enviar correus electrònics. Inclou la creació de directoris, registre d'activitat amb data i hora, llistat de processos i crida a "script_gmail.ps1" amb política d'execució bypass.</p>
<p><img alt="Captura" src="../custom/Selecci%C3%B3_070.png" /></p>
<p>Aquí hem creat el script PowerShell "script_email.ps1" que implementa un control d'execució única. El codi verifica si ja existeix una instància prèvia del script en execució mitjançant la consulta de processos PowerShell actius. Si detecta una execució duplicada, mostra un missatge i finalitza per evitar múltiples instàncies simultànies del mateix script.</p>
<p><img alt="Captura" src="../custom/Selecci%C3%B3_071.png" /></p>
<p>Aquí hem configurat els paràmetres d'enviament d'email al script PowerShell. S'estableixen les adreces de remitent i destinatari, l'assumpte de l'auditoria Windows, el cos del missatge, la ruta de l'arxiu adjunt i les credencials SMTP de Gmail amb el servidor "smtp.gmail.com" al port 587, utilitzant una contrasenya d'aplicació específica per a l'autenticació.</p>
<p><img alt="Captura" src="../custom/Selecci%C3%B3_072.png" /></p>
<p>Aquí configurem la gestió de logs al script PowerShell. Es defineix la carpeta "C:\Scripts\Service_logs" per emmagatzemar els registres i es comprova la seva existència, creant-la si cal. S'estableixen les rutes per als fitxers de log "system_log.txt" i "log.zip", i es genera un log inicial amb data actual si no existeix prèviament.</p>
<p><img alt="Captura" src="../custom/Selecci%C3%B3_073.png" /></p>
<p>Aquí definim les variables per recollir informació del sistema en el script PowerShell. S'inclouen dades com el nom de l'equip, usuari, sistema operatiu, processador, memòria RAM, discs durs, adaptadors de xarxa i els 10 processos que consumeixen més CPU, utilitzant cmdlets de CIM per obtenir informació detallada del hardware i el rendiment del sistema Windows.</p>
<p><img alt="Captura" src="../custom/Selecci%C3%B3_074.png" /></p>
<p>Aquí configurem el cos de l'email amb les dades recopilades del sistema. El body inclou informació formatejada sobre l'ordinador, usuari, sistema operatiu, CPU, memòria RAM, espai en disc, configuracions de xarxa i els 10 processos més consumidors de CPU. S'utilitzen càlculs per convertir bytes a MB/GB i es formategen les llistes amb <code>ForEach-Object</code> i <code>Out-String</code> per a una presentació llegible en el correu electrònic.</p>
<p><img alt="Captura" src="../custom/Selecci%C3%B3_075.png" /></p>
<p>Aquí completem el script PowerShell amb la compressió dels logs i l'enviament de l'email. Es comprimeix el fitxer de log en un arxiu ZIP i s'utilitza <code>Send-MailMessage</code> amb autenticació per credencials per enviar el correu electrònic amb l'arxiu adjunt. S'inclou gestió d'errors amb bloc <code>try-catch</code> per capturar i mostrar possibles errors durant l'enviament.</p>
<p><img alt="Captura" src="../custom/Selecci%C3%B3_068.png" /></p>
<p>Aquí es mostra l'email rebut amb l'auditoria del sistema Windows. El correu conté l'assumpte complet "Auditoria Windows 10 i Servei Executat Exitos By: Pellisa" i inclou les dades tècniques de l'equip DESKTOP-34U0860 amb l'usuari Pellisa, a més de l'arxiu adjunt "log.zip" amb els registres del sistema comprimits.</p>
<p><img alt="Captura" src="../custom/Selecci%C3%B3_069.png" /></p>
<p>Finalment aquí ens mostra l'email complet amb els resultats de l'auditoria del sistema. El correu inclou informació detallada de l'equip DESKTOP-34U0860 amb Windows 10 Pro, mostrant el processador Intel i7 amb càrrega del 100%, 4.6 GB de RAM, espai en disc i l'adaptador de xarxa amb IP 192.168.1.150. Es llisten els 10 processos més actius, sent "System" el que consumeix més CPU, i s'adjunta el fitxer comprimit amb els logs.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.4e0fa4ba.min.js"></script>
      
    
  </body>
</html>