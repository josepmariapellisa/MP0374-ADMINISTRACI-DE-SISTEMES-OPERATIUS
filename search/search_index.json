{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Benvinguts","text":"<p>Hola! S\u00f3c Josep Pellisa, alumne de 2n d\u2019ASIX a l\u2019Institut de l\u2019Ebre. En aquesta web presentare la meva memoria del M\u00f2dul Professional 0374 \u2013 Administraci\u00f3 de Sistemes Operatius, on exploro diferents aspectes de la gesti\u00f3 i configuraci\u00f3 de sistemes operatius tant en entorns Windows com Linux.</p> <p>Durant aquest m\u00f2dul, he treballarem en:</p> <ul> <li>Configuraci\u00f3 d\u2019inici amb serveis personalitzats (Windows)</li> <li>Creaci\u00f3 d\u2019entorn d\u2019arrencada amb systemd (Linux)</li> <li>Gesti\u00f3 de kernels i m\u00f2duls del sistema</li> <li>Servidor d\u2019impressi\u00f3 amb Windows i control d\u2019acc\u00e9s per domini</li> <li>Servidor d\u2019impressi\u00f3 a Ubuntu amb CUPS/Samba</li> <li>Connexi\u00f3 de clients Windows i Ubuntu a servidors d\u2019impressi\u00f3 heterogenis</li> <li>Automatitzaci\u00f3 funcional adaptada al context d\u2019\u00fas (Windows i Linux)</li> <li>RSAT, VPN i RDP (Windows)</li> <li>Centralitzaci\u00f3 d\u2019usuaris amb Active Directory</li> <li>Comparativa Ansible vs FOG</li> <li>Personalitzaci\u00f3 del sistema operatiu (Linux)</li> <li>Configuraci\u00f3 de NAS</li> </ul> <p>Aquesta p\u00e0gina servir\u00e0 com a resum i guia del que he apr\u00e8s i configurat durant el m\u00f2dul.</p>"},{"location":"LICENSE/","title":"Licencia Creative Commons Reconocimiento - No Comercial - Compartir Igual 4.0 Espa\u00f1a (CC BY-NC-SA 4.0)","text":"<p>Este trabajo est\u00e1 licenciado bajo la Licencia Creative Commons Reconocimiento - No Comercial - Compartir Igual 4.0 Espa\u00f1a (CC BY-NC-SA 4.0).</p>"},{"location":"LICENSE/#resumen","title":"Resumen","text":"<p>Esta licencia permite que otros compartan, copien y distribuyan tu trabajo, as\u00ed como adaptarlo o transformarlo, siempre que:  </p> <ul> <li>Reconozcan la autor\u00eda original.  </li> <li>No utilicen el trabajo con fines comerciales.  </li> <li>Distribuyan las obras derivadas bajo la misma licencia.  </li> </ul>"},{"location":"LICENSE/#texto-legal-completo","title":"Texto legal completo","text":"<p>Puedes consultar el texto completo de la licencia aqu\u00ed: Creative Commons CC BY 4.0</p>"},{"location":"LICENSE/#atribucion-y-condiciones","title":"Atribuci\u00f3n y condiciones","text":"<p>Se debe dar cr\u00e9dito adecuado, proporcionar un enlace a esta licencia e indicar si se han realizado cambios. Cualquier obra derivada debe distribuirse con la misma licencia y no se pueden imponer restricciones adicionales.</p> <p></p> <p>\u00a9 2025 Josep Pellisa</p>"},{"location":"systemd/","title":"Pr\u00e0tica 1","text":"<p>En aquesta pr\u00e0ctica treballarem amb systemd.</p> <p>Crearem un target personalitzat per agrupar serveis.  </p> <p>Tamb\u00e9 configurarem un servei que executar\u00e0 un script.  </p> <p>L\u2019script realitzar\u00e0 una acci\u00f3 simple per comprovar el funcionament.  </p> <p>Finalment, activarem i provarem tot el conjunt dins del sistema.</p> <p></p> <p>Primer que tot crearem el Target.</p> <p> He creat un target que s'activa quan tot est\u00e0 llest: xarxa, usuaris i escriptori. Aix\u00ed controlo que els meus serveis s'inic\u00efen en l'ordre correcte i amb totes les depend\u00e8ncies satisfetes.</p> <p> Aqui creem aquest directori perqu\u00e8 \u00e9s on systemd busca els serveis que han d'activar-se quan el teu target <code>pellisa.target</code> s'inici\u00ef. Els enlla\u00e7os simb\u00f2lics dels serveis que vulguis que s'executin amb el teu target aniran aqu\u00ed dins.</p> <p></p> <p>Hem configurat el sistema perqu\u00e8 utilitzi el nostre target personalitzat com a target per defecte. </p> <ol> <li><code>systemctl set-default pellisa.target</code> - Crea un enlla\u00e7 simb\u00f2lic per definir el nostre target com a predeterminat</li> <li><code>systemctl get-default</code> - Verifica que efectivament <code>pellisa.target</code> \u00e9s ara el target per defecte</li> </ol> <p>Ara el sistema sempre arrencar\u00e0 amb la nostra configuraci\u00f3 personalitzada.</p> <p></p> <p>Ara crearem el servei que tindrem associat al target.</p> <p></p> <p>Aqui veiem el servei systemd que executara el meu script personalitzat. El servei s'assegura que:</p> <ul> <li>S'inicia despr\u00e9s que la xarxa estigui activa</li> <li>Es reinicia autom\u00e0ticament si falla</li> <li>Est\u00e0 gestionat pel meu target <code>pellisa.target</code></li> <li>\u00c9s de tipus simple per executar el script directament</li> </ul> <p></p> <p>He activat el servei perqu\u00e8 s'inici\u00ef autom\u00e0ticament amb el target <code>pellisa.target</code>. Systemd ha creat un enlla\u00e7 simb\u00f2lic dins de la carpeta <code>pellisa.target.wants</code>, que \u00e9s exactament per aix\u00f2 que hav\u00edem creat aquest directori abans.</p> <p></p> <p>He recarregat la configuraci\u00f3 de systemd perqu\u00e8 detecti el nou servei creat. Aix\u00f2 \u00e9s necessari cada vegada que es crea o modifica un fitxer de servei perqu\u00e8 systemd l'incorpori sense necessitat de reiniciar el sistema.</p> <p></p> <p>He programat un script que recull informaci\u00f3 del sistema i envia una notificaci\u00f3. El script:</p> <ol> <li>Crea una carpeta segura i un fitxer amb data/hora</li> <li>Captura dades del sistema (hostname, IP, usuaris, espai de disc)</li> <li>Guarda tot en un fitxer d'informe</li> <li>Envia una notificaci\u00f3 d'escriptori amb missatge \"hackejada\" (\u00e9s broma, clar!)</li> </ol> <p></p> <p>He donat permisos d'execuci\u00f3 al script perqu\u00e8 systemd pugui executar-lo quan el servei s'inici\u00ef. Sense aquest perm\u00eds, el servei fallaria al intentar executar el script.</p> <p></p> <p>Aqui ja provem de reinciar l'equip i veiem que ja s'ens carrega el target amb el servei i executa el script, a l'ultima part veiem que ens surt failed ja que, la notificaci\u00f3 pop-up, ens genera un error.</p> <p></p> <p>I un cop reinciada veiem que s'ens ha generat l'informe amb les dades sensibles de l'equip.</p> <p>MILLORES DEl SCRIPT</p> <p></p> <p>Aquest script de bash est\u00e0 pensat per fer captures de pantalla autom\u00e0tiques i enviar-les per correu electr\u00f2nic. Primer defineix algunes variables importants com la carpeta de treball \"/home/client1/Excritorio/privat_pellisa\", la carpeta on es guardaran les captures, el fitxer de configuraci\u00f3 del msmtp (que \u00e9s un client de correu), l'adre\u00e7a de correu del destinatari \"josepmariapellisa@iesebre.com\", el prefix de l'assumpte del correu i el temps d'espera entre captures (5 segons). Despr\u00e9s crea la carpeta de captures si no existeix i li assigna permisos restringits (700) tant a la carpeta principal com a la de captures, amb un \"2&gt;/dev/null || true\" perqu\u00e8 no mostri errors si no pot canviar els permisos. L'script est\u00e0 preparat per capturar pantalles peri\u00f2dicament i enviar-les autom\u00e0ticament per correu al destinatari especificat.</p> <p></p> <p>En aquesta part del script definim els noms dels fitxers que utilitzarem, afegint-hi un timestamp perqu\u00e8 cada execuci\u00f3 tingui noms \u00fanics. Creem una variable DATA amb la data i hora actual en format any-mes-dia_hora-minut-segon. Definim FITXER com a l'arxiu d'informaci\u00f3 del sistema amb aquesta data, i ASSUMPTE com l'assumpte del correu amb el prefix i la data. Tamb\u00e9 configurem els noms per a la captura de pantalla en PNG, els arxius de text per als processos actius, les finestres obertes i la informaci\u00f3 del terminal, a m\u00e9s d'un arxiu TAR comprimit que agrupar\u00e0 totes les captures. Finalment, establim un BOUNDARY \u00fanic per a l'estructura MIME del correu electr\u00f2nic, assegurant-nos que no comenci amb gui\u00f3 per evitar conflictes.</p> <p></p> <p>En aquesta secci\u00f3 realitzem les captures del sistema. Primer esperem que l'entorn gr\u00e0fic estigui disponible utilitzant la funci\u00f3 wait_for_graphical. A continuaci\u00f3, intentem fer una captura de pantalla mitjan\u00e7ant la funci\u00f3 take_screenshot. Si la captura s'executa correctament, mostrem un missatge indicant on s'ha guardat el fitxer PNG. En cas contrari, si no es pot realitzar la captura (ja sigui per falta d'entorn gr\u00e0fic o perqu\u00e8 falten les eines necess\u00e0ries), informem de l'error i deixem la variable SCREENSHOT_PNG buida per indicar que no disposem d'aquesta captura.</p> <p></p> <p>En aquesta secci\u00f3 executem les diferents captures del sistema. Primer esperem que l'entorn gr\u00e0fic estigui disponible cridant la funci\u00f3 wait_for_graphical. A continuaci\u00f3, intentem realitzar una captura de pantalla mitjan\u00e7ant la funci\u00f3 take_screenshot. Si la captura s'executa amb \u00e8xit, mostrem un missatge per consola indicant la ruta on s'ha desat el fitxer PNG. En cas contrari, si no es pot completar la captura (ja sigui per abs\u00e8ncia d'entorn gr\u00e0fic o per manca de les eines necess\u00e0ries), notifiquem l'error i establim la variable SCREENSHOT_PNC com a buida per indicar que no tenim aquesta captura disponible.</p> <p></p> <p>En aquesta part capturem informaci\u00f3 dels processos del sistema. Executem una s\u00e8rie de comandos que redirigim cap a l'arxiu de processos: primer mostrem l'arbre de processos amb \"ps aux --forest\" limitat a 200 l\u00ednies, i si falla mostrem la llista simple de processos. Despr\u00e9s generem un llistat dels 20 processos que consumeixen m\u00e9s CPU, mostrant el PID, l'usuari, la comanda i el percentatge d'\u00fas de CPU i mem\u00f2ria. Tota aquesta informaci\u00f3 es guarda en el fitxer de processos definit anteriorment, ignorant possibles errors amb \"2&gt;/dev/null || true\". Finalment, assignem permisos restrictius (600) a aquest fitxer per garantir la seva seguretat.</p> <p></p> <p>En aquesta secci\u00f3 capturem informaci\u00f3 sobre les finestres obertes en l'entorn gr\u00e0fic. Primer comprovem si tenim disponible l'eina \"wmctrl\" al sistema, i en cas afirmatiu, executem \"wmctrl -lp\" per obtenir una llista detallada de les finestres amb els seus identificadors i processos. Si no disposem de \"wmctrl\", llavors cerquem l'eina \"xdotool\" i l'utilitzem per buscar totes les finestres visibles i obtenir els seus noms. En cas que no trobem cap d'aquestes dues eines, escrivim un missatge d'error en el fitxer indicant que no hi ha eina de gesti\u00f3 de finestres disponible. Finalment, assignem permisos restrictius (600) al fitxer de finestres per garantir la seva seguretat.</p> <p></p> <p>En aquesta secci\u00f3 capturem l'historial de la shell i preparem l'empaquetament de les captures. Primer comprovem si existeix el fitxer .bash_history a la carpeta de l'usuari. Si existeix, n'extraiem les \u00faltimes 200 l\u00ednies amb el comandament tail i les guardem al fitxer d'informaci\u00f3 del terminal. En cas que no es trobi el fitxer d'historial o no hi hagi permisos suficients, escrivim un missatge d'error al fitxer. Despr\u00e9s assignem permisos restrictius (600) al fitxer de terminal per seguretat. A continuaci\u00f3, creem un directori temporal amb un nom \u00fanic dins de la carpeta de captures utilitzant mktemp, i configurem un trap per assegurar-nos que aquest directori temporal s'eliminar\u00e0 autom\u00e0ticament quan l'script finalitzi, independentment de com acabi.</p> <p></p> <p>En aquesta secci\u00f3 copiem tots els fitxers de captures existents al directori temporal que hem creat. Primer intentem copiar el fitxer principal d'informaci\u00f3 del sistema preservant els permisos i enlla\u00e7os. Si aquesta c\u00f2pia falla, fem una c\u00f2pia normal. Despr\u00e9s, nom\u00e9s si la variable SCREENSHOT_PNG no est\u00e0 buida i el fitxer existeix realment, copiem la captura de pantalla al directori temporal. Seguidament, comprovem l'exist\u00e8ncia dels fitxers de processos, finestres i terminal, i per a cadascun d'ells que existeixi, el copiem al directori temporal preservant els seus permisos i enlla\u00e7os. Totes aquestes operacions inclouen redireccions d'error per evitar que possibles fallades en la c\u00f2pia interrompin l'execuci\u00f3 de l'script.</p> <p></p> <p>En aquesta secci\u00f3 creem l'arxiu comprimit amb totes les captures. Primer comprovem si el directori temporal cont\u00e9 algun fitxer utilitzant la comanda find combinada amb read. Si hi ha contingut al directori temporal, executem la comanda tar per crear un arxiu comprimit en format .tar.gz que inclogui tots els fitxers del directori temporal. Despr\u00e9s assignem permisos restrictius (600) a l'arxiu comprimit per garantir la seva seguretat i mostrem un missatge per consola indicant on s'ha guardat l'arxiu. Si el directori temporal est\u00e0 buit, mostrem un missatge indicant que no hi ha fitxers per empaquetar i deixem la variable TAR_CAPTURES buida per indicar que no s'ha generat cap arxiu.</p> <p></p> <p>En aquesta secci\u00f3 creem l'arxiu comprimit amb tot el contingut capturat. Primer comprovem si el directori temporal cont\u00e9 algun fitxer utilitzant la comanda <code>find</code> juntament amb <code>read</code> per detectar si hi ha elements dins del directori. Si trobem fitxers, executem la comanda <code>tar</code> per crear un arxiu comprimit en format .tar.gz que contingui tots els fitxers del directori temporal, canviant pr\u00e8viament al directori amb l'opci\u00f3 <code>-C</code> per evitar incloure rutes completes. Despr\u00e9s assignem permisos restrictius (600) a l'arxiu comprimit per motius de seguretat i mostrem un missatge d'\u00e8xit per consola. Si el directori temporal est\u00e0 buit, indiquem que no hi ha fitxers per empaquetar i deixem la variable TAR_CAPTURES buida per reflectir aquest estat.</p> <p></p> <p>En aquesta secci\u00f3 preparem l'enviament del correu electr\u00f2nic amb les captures. Primer comprovem si tenim instal\u00b7lat el client de correu <code>msmtp</code> al sistema. Si no el trobem disponible, mostrem un missatge d'ERROR per consola indicant que <code>msmtp</code> no est\u00e0 instal\u00b7lat i proporcionem la comanda necess\u00e0ria per instal\u00b7lar-lo (<code>sudo apt install msmtp</code>). A continuaci\u00f3, finalitzem l'execuci\u00f3 de l'script amb codi d'error 1 per evitar que continu\u00ef l'enviament sense tenir l'eina necess\u00e0ria. Aquesta comprovaci\u00f3 \u00e9s crucial per assegurar-nos que disposem de tot el necessari abans d'intentar enviar el correu electr\u00f2nic amb les captures recopilades.</p> <p></p> <p>En aquesta secci\u00f3 final constru\u00efm i enviem el correu electr\u00f2nic amb les captures. Primer generem la cap\u00e7alera del missatge MIME amb les dades del destinatari, assumpte i versi\u00f3. Si existeix l'arxiu comprimit amb les captures, creem un missatge multipart que inclou tant el text del correu com l'arxiu adjunt codificat en base64. Estructurem el missatge amb boundaries per separar les diferents parts. Si no hi ha arxiu per adjuntar, enviem nom\u00e9s el text pla amb la informaci\u00f3 del sistema. El missatge complet es redirigeix a msmtp per al seu enviament, utilitzant el fitxer de configuraci\u00f3 especificat i el compte de Gmail. Verifiquem l'estat de l'enviament: si \u00e9s exit\u00f3s, ho confirmem per consola; si hi ha error, informem i sortim amb codi d'error. Finalment, netegem els recursos temporals (gr\u00e0cies al trap configurat anteriorment) i sortim amb \u00e8xit.</p> <p></p> <p>Aquest \u00e9s un exemple de com es veuria el correu electr\u00f2nic que s'envia amb l'script. El missatge inclou l'assumpte amb data i hora exacta \"Informe+Captura - 2025-10-01_20-12-29\", est\u00e0 adre\u00e7at a l'usuari Josep2001pellisa@gmail.com i cont\u00e9 un text amable sol\u00b7licitant que es revisin les captures adjuntes. El cos del missatge \u00e9s breu i directe, amb una salutaci\u00f3 i la informaci\u00f3 de la data de generaci\u00f3. S'adjunten dos fitxers: l'informe i les captures comprimides, amb les dates corresponents.</p> <p></p> <p>Aquests s\u00f3n els fitxers individuals que es generen amb cada execuci\u00f3 de l'script de captures. Cada fitxer inclou la data i hora exacta (2025-10-01_20-12-29) per garantir que siguin \u00fanics i es puguin distingir entre diferents execucions. Tenim cinc tipus de fitxers: \"finestres\" que cont\u00e9 informaci\u00f3 sobre les finestres obertes en l'entorn gr\u00e0fic, \"info_sistema\" amb dades generals del sistema, \"processos\" que mostra els processos actius i l'\u00fas de recursos, \"screenshot\" que \u00e9s la captura de pantalla en format PNG, i \"terminal\" amb l'historial de comandes de la shell. Tots aquests fitxers s'empaqueten despr\u00e9s en un sol arxiu comprimit .tar.gz per al seu enviament per correu electr\u00f2nic.</p> <p></p> <p>Aquest \u00e9s el contingut de l'arxiu <code>info_sistema_2025-10-01_20-12-29.txt</code> que genera l'script. Cont\u00e9 un informe complet de l'estat del sistema en el moment de les captures. Inclou informaci\u00f3 b\u00e0sica com el nom del host (\"pellisa\"), la data i hora exacta de la captura, les adreces IP actives (en aquest cas 192.168.203.156), els usuaris connectats (client1 en tty2), el target actual del systemd i un resum de l'\u00fas dels discs amb <code>df -h</code>. Es pot observar que el disc principal (/dev/sda3) est\u00e0 al 57% de la seva capacitat, hi ha un disc de dades addicional (/dev/sdb1) muntat al 6%, i s'ha detectat un CD-ROM virtual de VirtualBox muntat al 100%. Aquesta informaci\u00f3 \u00e9s valuosa per fer un diagn\u00f2stic r\u00e0pid de l'estat del sistema.</p> <p></p> <p>Aquest \u00e9s el contingut de l'arxiu de processos que genera l'script. Mostra una llista dels processos actius en el sistema en el moment de la captura, limitada a les primeres 200 l\u00ednies. La taula inclou informaci\u00f3 detallada de cada proc\u00e9s: l'usuari que l'executa, el PID (Identificador de Proc\u00e9s), el percentatge d'\u00fas de CPU i mem\u00f2ria, la mem\u00f2ria virtual i resident utilitzada, la terminal associada, l'estat del proc\u00e9s, l'hora d'inici, el temps d'execuci\u00f3 i la comanda que l'ha llan\u00e7at.</p> <p></p> <p>Finalment aquest \u00e9s el contingut de l'arxiu d'historial del terminal que captura l'script. Mostra les \u00faltimes 200 comandes executades per l'usuari en la shell bash. Es pot veure un historial d'activitats d'administraci\u00f3 del sistema que inclou: canvis en el nom del host (hostname pellisa), instal\u00b7laci\u00f3 de paquets (apt install quota), modificaci\u00f3 d'usuaris (usermod), creaci\u00f3 i configuraci\u00f3 de serveis systemd, edici\u00f3 de scripts amb nano, i canvis de permisos d'execuci\u00f3.</p>"}]}